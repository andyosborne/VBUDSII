addpath(fullfile('serpent'))

findreplacequotes('serpent/mcnpxsimplant_res');
eval('mcnpxsimplant_res_revised');

mcnpxsimplant_xs0
mcnpxsimplant_det0

vbudsiiflux = [r.Cell(1).spectralFlux r.Cell(2).spectralFlux];
%vbudsiiflux = vbudsiiflux/ ...
%    sum(diff(L.groupDef').*sum(vbudsiiflux, 2));

mcnpflux = [Tally1{2}.value{1}(1:end-1) Tally1{1}.value{1}(1:end-1)];
mcnpxFluxIntegral = sum(diff(L.groupDef').*sum(mcnpflux, 2));
mcnpxflux = mcnpflux*max(max(vbudsiiflux))/max(max(mcnpflux));
%mcnpxflux = mcnpflux/mcnpxPowerDensity;
%mcnpxflux = mcnpflux/mcnpxFluxIntegral;

serpentflux = [DETcoolant(:, 11) DETfuel(:, 11)];
serpentflux = serpentflux/ ...
    sum(sum(serpentflux(:,1))) * ...
    sum(sum(vbudsiiflux(:,1)));
%    sum((DETcoolantE(:,2)-DETcoolantE(:,1)).*sum(serpentflux,2));

printplotxsn('/home/fitze/Dropbox/UTA/r/code/vbudsii/scripts/verval/mcnpxsimplant/serpent',...
    'fluxcompare_all', ...
    0, ...
    0, ...
    2, ...
    [], ...
    '', ...
    {...
    'VBUDSII coolant', ...
    'VBUDSII fuel', ...
    'Serpent coolant', ...
    'Serpent fuel', ...
    'MCNPX coolant', ...
    'MCNPX fuel', ...
    },...
    '', ...
    L.groupDef, ...
    {serpentflux(:, 1), ...
     serpentflux(:, 2), ...
     mcnpxflux(:, 1), ...
     mcnpxflux(:, 2)}, ...
    L.groupDef, ...
    {vbudsiiflux(:, 1), ...
    vbudsiiflux(:, 2)} ...
    );

printplotxsn('/home/fitze/Dropbox/UTA/r/code/vbudsii/scripts/verval/mcnpxsimplant/serpent',...
    'fluxcompare_vbudsiimcnpx', ...
    0, ...
    0, ...
    2, ...
    [], ...
    '', ...
    {...
    'VBUDSII coolant', ...
    'VBUDSII fuel', ...
    'MCNPX coolant', ...
    'MCNPX fuel', ...
    },...
    '', ...
    L.groupDef, ...
    {mcnpxflux(:, 1), ...
     mcnpxflux(:, 2)}, ...
    L.groupDef, ...
    {vbudsiiflux(:, 1), ...
    vbudsiiflux(:, 2)} ...
    );

printplotxsn('/home/fitze/Dropbox/UTA/r/code/vbudsii/scripts/verval/mcnpxsimplant/serpent',...
    'fluxcompare_vbudsiiserpent', ...
    0, ...
    0, ...
    2, ...
    [], ...
    '', ...
    {...
    'VBUDSII coolant', ...
    'VBUDSII fuel', ...
    'Serpent coolant', ...
    'Serpent fuel' ...
    },...
    '', ...
    L.groupDef, ...
    {serpentflux(:, 1), ...
     serpentflux(:, 2)}, ...
    L.groupDef, ...
    {vbudsiiflux(:, 1), ...
    vbudsiiflux(:, 2)} ...
    );

printplotxsn('/home/fitze/Dropbox/UTA/r/code/vbudsii/scripts/verval/mcnpxsimplant/serpent',...
    'fluxcompare_mcnpxserpent', ...
    0, ...
    0, ...
    2, ...
    [], ...
    '', ...
    {...
    'Serpent coolant', ...
    'Serpent fuel', ...
    'MCNPX coolant', ...
    'MCNPX fuel', ...
    },...
    '', ...
    L.groupDef, ...
    {serpentflux(:, 1), ...
     serpentflux(:, 2), ...
     mcnpxflux(:, 1), ...
     mcnpxflux(:, 2)} ...
    );
printxsn('/home/fitze/Dropbox/UTA/r/code/vbudsii/scripts/verval/mcnpxsimplant/serpent', ...
    'xscompare1', ...
    0, ...
    0, ...
    2, ...
    [], ...
    '', ...
    {'Serpent total', 'VBUDSII coolant total', 'VBUDSII fuel total'}, ...
    '', ...
    L.groupDef, ...
    {r.Cell(1).fine(L.MT(18)).value, ...
     r.Cell(2).fine(L.MT(18)).value}, ...
    L.groupDef, ...
    {FISSXS(221:-2:3)} ...
    );
